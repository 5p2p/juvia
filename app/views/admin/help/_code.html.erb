<script type="text/javascript" class="juvia">
(function() {
    var options = {
        container  : '<%= local_assigns[:container] %>',
        site_key   : '<%= local_assigns[:site_key] %>',
        topic_key  : '<%= local_assigns[:topic_key] %>',
        topic_url  : location.href,
        topic_title: document.title || location.href
    };
    
    var API_URL = 'http://127.0.0.1:3000/api/show_topic.js';
    
    function makeQueryString(options) {
        var key, params = [];
        for (key in options) {
            params.push(
                encodeURIComponent(key) +
                '=' +
                encodeURIComponent(options[key]));
        }
        return params.join('&amp;');
    }
    
    if (!('_juviaRequestCounter' in window)) {
        window._juviaRequestCounter = 0;
    }
    
    var s       = document.createElement('script');
    s.async     = true;
    s.type      = 'text/javascript';
    s.className = 'juvia';
    s.src       = API_URL +
        '?_c=' + window._juviaRequestCounter +
        '&amp;' + makeQueryString(options);
    window._juviaRequestCounter++;
    (document.getElementsByTagName('head')[0] ||
     document.getElementsByTagName('body')[0]).appendChild(s);
})();
</script>